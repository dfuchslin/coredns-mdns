# Rewrite bare hostnames to .local and resolve via mDNS (avahi2dns).
# All other queries forwarded to upstream DNS.

.:53 {
    errors
    log
    cache 30
    loop

    # Bare single-label names (no dots) get rewritten to <name>.local
    # "answer auto" rewrites the response back so the client sees the
    # original name it asked for.
    rewrite name regex (^[^.]+\.)$ {1}local. answer auto

    # .local queries go to avahi2dns
    forward local. 127.0.0.1:5454 {
        prefer_udp
    }

    # Everything else goes to upstream
    forward . 9.9.9.9 {
        prefer_udp
    }
}
